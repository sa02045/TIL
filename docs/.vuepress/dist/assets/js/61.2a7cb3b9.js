(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{421:function(t,s,a){"use strict";a.r(s);var n=a(44),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"jwt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jwt"}},[t._v("#")]),t._v(" JWT?")]),t._v(" "),a("blockquote",[a("p",[t._v("JSON Web Tokeㅜ")])]),t._v(" "),a("h2",{attrs:{id:"세션-기반-인증-vs-토큰-기반-인증"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#세션-기반-인증-vs-토큰-기반-인증"}},[t._v("#")]),t._v(" 세션 기반 인증 vs 토큰 기반 인증")]),t._v(" "),a("h3",{attrs:{id:"세션-기반-인증"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#세션-기반-인증"}},[t._v("#")]),t._v(" 세션 기반 인증")]),t._v(" "),a("blockquote",[a("p",[t._v("서버가 사용자의 로그인 상태를 기억하고 있음")])]),t._v(" "),a("ol",[a("li",[t._v("사용자가 로그인을 하면 서버는 세션 저장소에서 사용자의 정보를 조회한다")]),t._v(" "),a("li",[t._v("정보를 조회한 뒤 세션 id를 발급한다")]),t._v(" "),a("li",[t._v("사용자는 발급받은 세션 id를 브라우저의 쿠키에 저장한다")]),t._v(" "),a("li",[t._v("사용자는 다른 요청을 보낼때마다 서버는 세션 저장소에서 세션을 조회한후")]),t._v(" "),a("li",[t._v("로그인 여부를 결정하여 작업을 처리하고 응답한다")]),t._v(" "),a("li",[t._v("세션 저장소는 메모리,디스크,데이터베이스등을 사용한다")])]),t._v(" "),a("h3",{attrs:{id:"세션기반인증의-단점"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#세션기반인증의-단점"}},[t._v("#")]),t._v(" 세션기반인증의 단점")]),t._v(" "),a("ul",[a("li",[t._v("서버를 확장하기 번거롭다")]),t._v(" "),a("li",[t._v("서버의 인스턴스가 여러개라면, 모든 서버는 같은 세션을 공유해야 하기 때문이다")]),t._v(" "),a("li",[t._v("세션전용 데이터베이스를 만들어야 한다")])]),t._v(" "),a("h3",{attrs:{id:"토큰-기반-인증"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#토큰-기반-인증"}},[t._v("#")]),t._v(" 토큰 기반 인증")]),t._v(" "),a("blockquote",[a("p",[t._v("토큰은 로그인 이후 서버가 만들어 주는 문자열으로, 문자열 안에는 로그인 정보인 서버에서 발급되었음을 증명하는 서명이 들어있다")])]),t._v(" "),a("ul",[a("li",[t._v("서명 데이터는 해싱 알고리즘으로 만들어지고, RSA SHA256 또는 HMAC SHA256알고리즘이 사용된다")])]),t._v(" "),a("ol",[a("li",[t._v("서버에서 만든 토큰은 서명이 있기 때문에 무결성이 보장된다\n"),a("blockquote",[a("p",[t._v("정보가 변경되거나 위조되지 않았음을 의미한다")])])]),t._v(" "),a("li",[t._v("사용자가 로그인하면 서버에서 사용자에게 해당 사용자의 정보를 지니는 토큰을 발급해 주고")]),t._v(" "),a("li",[t._v("사용자가 다른 API를 요청하게 될 때 발급 받은 토큰과 함께 요청하게 한다")]),t._v(" "),a("li",[t._v("서버는 해당 토큰이 유효한지 검사하고 결과에 따라 응답한다")])]),t._v(" "),a("h3",{attrs:{id:"토크기반의-장점"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#토크기반의-장점"}},[t._v("#")]),t._v(" 토크기반의 장점")]),t._v(" "),a("ul",[a("li",[t._v("서버에서 사용자의 로그인 정보를 기억하기 위해 사용하는 리소스가 적다")]),t._v(" "),a("li",[t._v("사용자쪽에서 로그인 상태를 지닌 토큰을 가지고 있기 때문에 서버의 확장성이 높다")])]),t._v(" "),a("h3",{attrs:{id:"jwt-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jwt-2"}},[t._v("#")]),t._v(" jwt")]),t._v(" "),a("p",[t._v("npm i jsonwebtoken")]),t._v(" "),a("ol",[a("li",[t._v("첫번째 파라미터로 토크안에 넣고 싶은 데이터")]),t._v(" "),a("li",[t._v("두번째 파라미터로 JWT 시크릿 키")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" token "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" jwt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//첫번째 파라미터로 토크안에 넣고 싶은 데이터 패스워드는 X")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      _id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      username"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//두번째 파리미터로 JWT 시크릿 키를 넣음")]),t._v("\n    process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JWT_SECRET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      expireIn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'7d'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"사용자의-토큰-관리"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#사용자의-토큰-관리"}},[t._v("#")]),t._v(" 사용자의 토큰 관리")]),t._v(" "),a("h4",{attrs:{id:"_1-localstorage-sessionstorage에-저장"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-localstorage-sessionstorage에-저장"}},[t._v("#")]),t._v(" 1. localStorage , sessionStorage에 저장")]),t._v(" "),a("ul",[a("li",[t._v("누군가가 페이지에 악성 스크립트를 삽입한다면 쉽게 토큰을 탈취 할 수 있습니다(XSS cross site scripting )")])]),t._v(" "),a("h4",{attrs:{id:"_2-브라우저의-쿠키에-담아-사용"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-브라우저의-쿠키에-담아-사용"}},[t._v("#")]),t._v(" 2. 브라우저의 쿠키에 담아 사용")]),t._v(" "),a("ul",[a("li",[t._v("쿠키는 httpOnly라는 속성을 활성화하여 자바스크립트를 통해 쿠키를 조회할 수 없으므로 악성스크립트로 안전")]),t._v(" "),a("li",[t._v("대신 CSRF라는 공격에 취약해질 수 있음\n"),a("ul",[a("li",[t._v("토큰을 쿠키에 담으면 사용자가 서버에 요청을 할 때마다 무조건 토큰이 함께 전달됨")]),t._v(" "),a("li",[t._v("사용자가 모르게 원하지 않는 API요청을 하게 만듬")]),t._v(" "),a("li",[t._v("사용자가 자신도 모르는 상황에서 글을 작성하거나, 삭제, 탈퇴를 하게 만들 수 있음")])])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" token "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("generateToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"access_token"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  maxAge"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  httpOnly"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);