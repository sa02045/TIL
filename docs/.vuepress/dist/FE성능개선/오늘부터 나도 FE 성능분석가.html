<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>성능 분석가의 관심사 (GOAL) | 물처럼 흐르는 기억을 바위에 새기듯 글로 쓰자</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Today I Learned">
    
    <link rel="preload" href="/til/assets/css/0.styles.0f977fbb.css" as="style"><link rel="preload" href="/til/assets/js/app.c298c694.js" as="script"><link rel="preload" href="/til/assets/js/2.52735d0a.js" as="script"><link rel="preload" href="/til/assets/js/26.e10e30a0.js" as="script"><link rel="prefetch" href="/til/assets/js/10.9f1952d9.js"><link rel="prefetch" href="/til/assets/js/11.3df0f959.js"><link rel="prefetch" href="/til/assets/js/12.6d4e4f35.js"><link rel="prefetch" href="/til/assets/js/13.05db10f9.js"><link rel="prefetch" href="/til/assets/js/14.24ce5bd9.js"><link rel="prefetch" href="/til/assets/js/15.70c06597.js"><link rel="prefetch" href="/til/assets/js/16.85e1d6f6.js"><link rel="prefetch" href="/til/assets/js/17.7168c504.js"><link rel="prefetch" href="/til/assets/js/18.a3acaff1.js"><link rel="prefetch" href="/til/assets/js/19.ed1e3b6c.js"><link rel="prefetch" href="/til/assets/js/20.4e888043.js"><link rel="prefetch" href="/til/assets/js/21.06a52a01.js"><link rel="prefetch" href="/til/assets/js/22.c6204147.js"><link rel="prefetch" href="/til/assets/js/23.abc4b377.js"><link rel="prefetch" href="/til/assets/js/24.a4d0c1a1.js"><link rel="prefetch" href="/til/assets/js/25.a456de94.js"><link rel="prefetch" href="/til/assets/js/27.f9b45bd2.js"><link rel="prefetch" href="/til/assets/js/28.92b76d8e.js"><link rel="prefetch" href="/til/assets/js/29.2f142880.js"><link rel="prefetch" href="/til/assets/js/3.cccbb63f.js"><link rel="prefetch" href="/til/assets/js/30.01464a37.js"><link rel="prefetch" href="/til/assets/js/31.2ae666fb.js"><link rel="prefetch" href="/til/assets/js/32.be97019d.js"><link rel="prefetch" href="/til/assets/js/33.04d6f503.js"><link rel="prefetch" href="/til/assets/js/34.6c5e43a2.js"><link rel="prefetch" href="/til/assets/js/35.042460e5.js"><link rel="prefetch" href="/til/assets/js/36.7e8b2771.js"><link rel="prefetch" href="/til/assets/js/37.491458af.js"><link rel="prefetch" href="/til/assets/js/38.c6df4101.js"><link rel="prefetch" href="/til/assets/js/39.55944da4.js"><link rel="prefetch" href="/til/assets/js/4.3f39f4a3.js"><link rel="prefetch" href="/til/assets/js/40.eea7b92b.js"><link rel="prefetch" href="/til/assets/js/41.7c7a9a7b.js"><link rel="prefetch" href="/til/assets/js/42.77ef0842.js"><link rel="prefetch" href="/til/assets/js/43.ea13df46.js"><link rel="prefetch" href="/til/assets/js/44.38046ccc.js"><link rel="prefetch" href="/til/assets/js/45.27261d00.js"><link rel="prefetch" href="/til/assets/js/46.8105d9ff.js"><link rel="prefetch" href="/til/assets/js/47.87d0d8a5.js"><link rel="prefetch" href="/til/assets/js/48.fac7bd07.js"><link rel="prefetch" href="/til/assets/js/49.da186938.js"><link rel="prefetch" href="/til/assets/js/5.6eff8140.js"><link rel="prefetch" href="/til/assets/js/50.191cbcd1.js"><link rel="prefetch" href="/til/assets/js/51.ec837e21.js"><link rel="prefetch" href="/til/assets/js/52.a0bfef45.js"><link rel="prefetch" href="/til/assets/js/53.b16881c0.js"><link rel="prefetch" href="/til/assets/js/54.cd3800cd.js"><link rel="prefetch" href="/til/assets/js/55.b9017abe.js"><link rel="prefetch" href="/til/assets/js/56.3c38b42c.js"><link rel="prefetch" href="/til/assets/js/57.7a2b07c8.js"><link rel="prefetch" href="/til/assets/js/58.ce4fc072.js"><link rel="prefetch" href="/til/assets/js/59.70915ffe.js"><link rel="prefetch" href="/til/assets/js/6.17d5dd20.js"><link rel="prefetch" href="/til/assets/js/60.9e3a2459.js"><link rel="prefetch" href="/til/assets/js/61.318c37a6.js"><link rel="prefetch" href="/til/assets/js/62.c9b16612.js"><link rel="prefetch" href="/til/assets/js/63.5c8b4e8d.js"><link rel="prefetch" href="/til/assets/js/64.9a8c1295.js"><link rel="prefetch" href="/til/assets/js/65.248b0667.js"><link rel="prefetch" href="/til/assets/js/66.0832e390.js"><link rel="prefetch" href="/til/assets/js/7.a1d4137f.js"><link rel="prefetch" href="/til/assets/js/8.40057806.js"><link rel="prefetch" href="/til/assets/js/9.e58b97e7.js">
    <link rel="stylesheet" href="/til/assets/css/0.styles.0f977fbb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/til/" class="home-link router-link-active"><!----> <span class="site-name">물처럼 흐르는 기억을 바위에 새기듯 글로 쓰자</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>알고리즘</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/til/Algorithm/C++입력.html" class="sidebar-link">C++ 입력정리</a></li><li><a href="/til/Algorithm/C++배열선언.html" class="sidebar-link">C++ 배열선언</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Express</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>login</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NodeJS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="성능-분석가의-관심사-goal"><a href="#성능-분석가의-관심사-goal" class="header-anchor">#</a> 성능 분석가의 관심사 (GOAL)</h1> <p>첫 번째, 서버 성능분석의 관심사는?
| 서버가 얼마나 빠른가, 얼마나 많은 요청을 처리하는가?
TPS가 중요(Transition Per Seconds)</p> <p>두 번째, FE 성능분석의 관심사는?
| 사용자의 입력에 따라 얼마나 빠르게 반응하는가?
LAL이 중요(Loading and Interaction)</p> <h2 id="lal"><a href="#lal" class="header-anchor">#</a> LAL</h2> <ol><li>초기 로딩 속도
<ul><li>얼마나 빨리 페이지를 볼 수 있는가</li></ul></li> <li>인터렉션 속도
<ul><li>스크롤이 버벅거리는가</li> <li>키보드 입력이 버벅거리는가</li> <li>애니메이션이 매끄럽게 동작하는가</li></ul></li></ol> <h1 id="성능분석의-대상"><a href="#성능분석의-대상" class="header-anchor">#</a> 성능분석의 대상</h1> <p>| 숲을 보자</p> <ul><li>서비스에서 가장 많이 사용하는 화면은?</li> <li>서비스에서 사용자에게 가장 가치있는 화면은?</li></ul> <h1 id="개선-프로세스"><a href="#개선-프로세스" class="header-anchor">#</a> 개선 프로세스</h1> <ol><li>측정</li> <li>분석</li> <li>최적화</li></ol> <p>측정 -&gt; 분석 -&gt; 최적화 -&gt; 측정 -&gt; 분석.... 의 반복</p> <p>언제까지? -&gt; 도달할 때 까지</p> <p>네이버는</p> <ul><li>모바일 1.5초</li> <li>PC 2초를 초기 페이지 로딩속도로 목표</li></ul> <h1 id="성능-개선-시작하기"><a href="#성능-개선-시작하기" class="header-anchor">#</a> 성능 개선 시작하기</h1> <h2 id="첫-번째-로딩-속도-측정-분석하기"><a href="#첫-번째-로딩-속도-측정-분석하기" class="header-anchor">#</a> 첫 번째, 로딩 속도 측정, 분석하기</h2> <p>| 핵심은 Waterfall 차트를 개선하는 것</p> <ul><li>높이를 줄이고</li> <li>폭을 줄이고</li> <li>간격을 땡기고</li> <li>최종 점검하기</li></ul> <h1 id="높이-줄이기-요청-수를-줄이기"><a href="#높이-줄이기-요청-수를-줄이기" class="header-anchor">#</a> 높이 줄이기 (요청 수를 줄이기)</h1> <ol><li>JS, CSS Merge (Webpack)</li> <li>CSS Sprite (재활용)</li> <li>Data URI
<ul><li>캐싱되지 않아도 될 이미지를 HTML 요청에 포함시키기</li></ul></li></ol> <h2 id="효과적인-방법"><a href="#효과적인-방법" class="header-anchor">#</a> 효과적인 방법</h2> <p>| 초기 로딩 시 불필요한 자원을 삭제하거나 Lazy하게 요청하기</p> <ul><li>실수로 요청한 자원</li> <li>초기 로딩시 필요 없는 JS</li> <li>뷰 포트 바깥에 있는 이미지등(슬라이더,carousel등)</li></ul> <h3 id="뭐니뭐니해도-이미지"><a href="#뭐니뭐니해도-이미지" class="header-anchor">#</a> 뭐니뭐니해도 이미지</h3> <p>| 가장 많은 사이즈를 잡아 먹음</p> <ul><li>해결책은 Lazy 하게 이미지를 불러오는 것</li></ul> <h3 id="그외"><a href="#그외" class="header-anchor">#</a> 그외</h3> <ul><li>브라우저는 호스트마다 동시에 연결할 수 있는 개수가 정해져 있음</li> <li>요청 수가 많으면 사용할 수 있는 connection 수를 초과하여 다른 요청은 브라우저에서 대기하게 됨</li> <li>결국 , 요청은 적으면 적을 수록 좋다</li></ul> <h1 id="폭-줄이기"><a href="#폭-줄이기" class="header-anchor">#</a> 폭 줄이기</h1> <p>| 많은 정보를 담고 있는 reqeust</p> <h2 id="_1-initial-connection"><a href="#_1-initial-connection" class="header-anchor">#</a> 1. Initial Connection</h2> <ol><li>HTTP 프로토콜 마다 Connection 활용 방법이 다르다</li> <li>이 부분을 개선시키고 싶다면 HTTP2가 정답. 즉, 커넥션에 대한 튜닝은 프로토콜을 바꾸는 방법 밖에 없음</li></ol> <h2 id="_2-time-to-first-byte-ttfb"><a href="#_2-time-to-first-byte-ttfb" class="header-anchor">#</a> 2. Time to First Byte(TTFB)</h2> <p>TTFB가 오래 걸린다는 뜻은, 서버 비지니스 로직이 느리다는 의미(서버가 느리다!)</p> <ul><li><p>Content Download 문제면</p> <ol><li>네트워크 속도가 늦다</li> <li>Content Size가 크다</li></ol></li> <li><p>해결책은</p> <ol><li>JS, CSS를 Minify한다
<ul><li>주석제거, 공백제거</li> <li>변수명 변경하기</li></ul></li> <li>gzip 적용하기</li> <li>이미지는 포맷에 따라 성능이 차이남(png,jpg 등등...)</li> <li>이미지의 메타정보(찍은 날짜등등)을 제거해서 최적화를 하는것이 좋음</li></ol></li></ul> <h2 id="decode-비용"><a href="#decode-비용" class="header-anchor">#</a> Decode 비용</h2> <p>| 이미지 데이터를 RGB로 변환하는 과정</p> <p>Request -&gt; Decode -&gt; Copy to GPU -&gt; Display</p> <h1 id="_3-간격땡기기-request-계단-간격을-땡겨보자"><a href="#_3-간격땡기기-request-계단-간격을-땡겨보자" class="header-anchor">#</a> 3. 간격땡기기 : Request 계단 간격을 땡겨보자</h1> <h2 id="브라우저-렌더링-과정"><a href="#브라우저-렌더링-과정" class="header-anchor">#</a> 브라우저 렌더링 과정</h2> <ol><li>서버로부터 HTML 문자열을 Stream으로 받아와서</li> <li><code>&lt;head&gt;</code> 태그에 포함된 자원을 <code>병렬</code>로 다운로드</li> <li><code>&lt;head&gt;</code> 태그에 포함된 자원을 모두 실행함(그전까지는 브라우저는 흰 화면)</li> <li><code>&lt;body&gt;</code> 태그로부터 화면을 그리기 시작한다</li> <li>DOM 구성이 완료되면 <code>DOMContentLoaded</code> 이벤트가 발생함</li> <li>모든 자원의 로딩이 완료되면 load이벤트가 발생함</li></ol> <h3 id="그런데-여기서-js는-dom-cssom을-건드리를-수-있는-구조"><a href="#그런데-여기서-js는-dom-cssom을-건드리를-수-있는-구조" class="header-anchor">#</a> 그런데 여기서 JS는 DOM, CSSOM을 건드리를 수 있는 구조</h3> <p>| Render과정을 다시 거쳐야함</p> <h2 id="정리"><a href="#정리" class="header-anchor">#</a> 정리</h2> <ol><li>Head태그에는 CSS와 필수 JS만 넣어라
<ul><li>모두 다운로드, 실행되기 전에는 브라우저는 아무것도 그리지 않는다.</li> <li>body 태그 마지막에 JS를 넣어라
<ul><li>중간중간에 JS를 넣지마라</li> <li>왜냐하면 렌더링 블락이 생기기 때문이다</li> <li>HTML파서가 파싱을 하면서 JS를 만나면 실행하기 때문</li></ul></li></ul></li></ol> <h3 id="async-defer"><a href="#async-defer" class="header-anchor">#</a> async, defer</h3> <ul><li>DOM제어와 관련이 있는 스크립트와 defer를 사용</li> <li>의존성이 없는 스크립트는 async를 사용</li></ul> <h3 id="css파일에서-폰트-이미지를-사용하는-경우"><a href="#css파일에서-폰트-이미지를-사용하는-경우" class="header-anchor">#</a> CSS파일에서 폰트, 이미지를 사용하는 경우</h3> <ul><li>CSS가 불러와진 다음에 CSS에서 사용하는 폰트 이미지가 로딩됨</li> <li>해결책 -&gt; <code>preload</code> : 미리 자원을 부를 수 있음</li> <li>또는 HTTP2 Server push : HTML과 함께 JS,CSS,이미지가 로딩됨</li></ul> <h3 id="체감속도-높이기"><a href="#체감속도-높이기" class="header-anchor">#</a> 체감속도 높이기</h3> <ol><li>First Paint: Head 태그 종료 후 그려짐</li> <li>First Meaningful Paint: Hero 엘리먼트가 보이는 시기</li></ol> <p>위 두가지를 높이게 노력하면 체감속도가 높아짐</p> <p>서비스 차원에서는</p> <ul><li>Hero 엘리먼트</li> <li>Lazy하게 처리해야하는 요소를 결정해야 함</li></ul> <p>또는
Request의 균형감을 찾아야함</p> <ul><li>각각의 Request를 균등한 크기로 맞추기</li></ul> <h1 id="인터렉션"><a href="#인터렉션" class="header-anchor">#</a> 인터렉션</h1> <p>| 상황에 따라 최적화 방법이 다르다
하지만 하나의 원리로 귀결</p> <blockquote><p>브라우저 Main Thread는 건드리지 않기!</p></blockquote> <h2 id="문제는-동적언어-js"><a href="#문제는-동적언어-js" class="header-anchor">#</a> 문제는 동적언어 JS</h2> <p>| 자바스크립트가 DOM을 건드리면 기본적을 Main Thread에 의해서 Rendering Pipeline이 동작하게됨</p> <h3 id="rendering-pipeline이해하기"><a href="#rendering-pipeline이해하기" class="header-anchor">#</a> Rendering Pipeline이해하기</h3> <p>JS로 DOM을 변경하면</p> <ol><li>Style Recalculate : DOM의 최종 스타일을 계산</li> <li>Layout : DOM의 배치와 크기를 계산함</li> <li>Paint : 화면에 그림</li> <li>Composition: 레이어를 조합</li></ol> <p>해결책 -&gt; 최대한 덜 그리고, 적게 그리도록 만들어야함</p> <h4 id="해결책"><a href="#해결책" class="header-anchor">#</a> 해결책</h4> <ol><li>Layout이 발생하는 속성 건드리지 않기</li> <li>도와줘 GPU
<ul><li>Main Thread(CPU)가 아닌 GPU의 도움을 받기</li></ul></li></ol> <h4 id="gpu의-도움을-받기위해서-레이어를-만들기"><a href="#gpu의-도움을-받기위해서-레이어를-만들기" class="header-anchor">#</a> GPU의 도움을 받기위해서 레이어를 만들기</h4> <ul><li>브라우저가 규칙에 따라 레이어를 구성함</li> <li>명시적으로 레이어를 구성하기</li></ul> <h4 id="gpu의-side-effect"><a href="#gpu의-side-effect" class="header-anchor">#</a> GPU의 Side Effect</h4> <ul><li>레이어를 구성하는 작업은 초기에는 CPU가 진행</li> <li>레이어에 원래 비트맵 정보를 복사하기 위해 2배의 메모리가 필요함
| 해결책 -&gt; 꼭 필요한 부분만 레이어로 만든다</li></ul> <h4 id="_60fps-보장하기"><a href="#_60fps-보장하기" class="header-anchor">#</a> 60FPS 보장하기</h4> <ul><li>렌더링 파이프가 계속해서 발생하는 경우 1Frame은 16ms내에 완료되어야함</li> <li>애니메이션에서는 requestAnimationFrame API으로 16ms 주기를 완료</li></ul> <h4 id="dom을-건드리지-않는-js코드-실행시간도-동일"><a href="#dom을-건드리지-않는-js코드-실행시간도-동일" class="header-anchor">#</a> DOM을 건드리지 않는 JS코드 실행시간도 동일</h4> <ul><li>서비스 Biz 로직이 대다수...</li> <li>서비스 개발자가 가장 잘 고칠 수 있음</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/til/assets/js/app.c298c694.js" defer></script><script src="/til/assets/js/2.52735d0a.js" defer></script><script src="/til/assets/js/26.e10e30a0.js" defer></script>
  </body>
</html>
