# Nginx

어떤 기술을 `왜` 쓰는지 알면, `무엇을` `언제` 기술을 사용하는지를 알 게

## Nginx란

- 웹서버

### 웹서버 VS WAS(웹 어플리케이션 서버)

1. 웹서버는 `정적` 파일을 응답한다
2. WAS는 클라이언트 요청에 대해 동적처리를 한 후 응답

## Nginx를 사용하는 이유

1. WAS의 부담을 덜어주기 위해

ex) 사용자가 이미지 파일을 요청하면?

- WAS가 처리해줄 수 도 있지만, 과부하를 덜어주기 위해 웹서버에서 처리

### 굳이 Nginx를 사용하는 이유

1. 빠르다
2. 효울적인 메모리 사용
3. 리버스 프록시로 사용 가능

   - 로드 밸런싱 가능
   - 캐싱 가능
   - 보안 효과

4. SSL 지원

   - 보안 인증서
   - https 인증서를 제공해줄 수 있음

5. 웹페이지 접근을 인증 해 줄 수 있음
   - user, 관리자를 판별
6. 압축

   - 클라이언트의 요청이 text인 경우 압축 가능

7. 비동기처리 가능
   - 이벤트루프 방식 사용
   - 많은 트래픽을 동시에 처리할 수 있다.

## Nginx도 비동기 NodeJS도 비동기

- Nginx를 앞단에, NodeJS를 뒷단에 두면 `버퍼오버플로우` 취약점에 대한 공격을 방지 할 수 있음

## 구축하기

1. 클라이언트가 HTTP로 접속을 하면 80번 포트로 접속이 됨
   - 국룰
2. HTTPS로 접속을 하면 443번 포트로 접속을 함

3. Nginx로 80번포트를 받아 443번 포트로 redirect해줌

4. Nginx를 설치하면 설정파일이 생기고, 설정파일을 수정해줘야함

### 어떤 설정?

1. HTTP 80번포트로 들어오면 HTTPS 443번 포트로 우회시키기

```sh

server{
    liten 80;
    server_name NAME;
    if($host = NAME){
        return 301 https://$host$requset_url;
    }
}

```

- \$host는 클라이언트의 주소

2. 443번 포트 처리

- SSL인증서 사용
- 5000번 포트로 우회

```sh
sever{
    listen 443 ssl;
    server_name NAME;
    location/{
        proxy_pass http://127.0.0.1:5000
    }
}

```
